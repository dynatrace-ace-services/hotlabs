{"version":13,"variables":[{"key":"Owner","type":"query","input":"fetch dt.entity.host\n| fieldsAdd entity.type,tags, osType, tag = toString(tags)\n| parse toString(tags), \"LD 'dt.owner:'[A-Za-z0-9-_]+:team\"\n| fieldsRemove tag\n| fields team","multiple":false}],"tiles":{"5":{"type":"data","title":"Host Cost per Hour Over Time","query":"fetch bizevents\n| filter event.type == \"instance.spend\"\n\n| lookup \n [fetch dt.entity.host\n | fieldsAdd tagged = contains(toString(tags), concat(\"dt.owner:\",$Owner))],\nlookupField:id, sourceField:dt.entity.host\n\n| filter lookup.tagged == true\n\n| summarize `Hour` = sum(total_hourly_cost), by:{dt.entity.host, bin(timestamp, 1h)}\n| limit 20000\n","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"areaChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"dt.entity.host","categoryAxisLabel":"dt.entity.host","valueAxis":"Hour","valueAxisLabel":"Hour"},"fieldMapping":{"timestamp":"bin(timestamp, 1h)","leftAxisValues":["Hour"],"leftAxisDimensions":["dt.entity.host"],"fields":[],"values":[]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","recordField":"dt.entity.host"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}}}},"6":{"type":"markdown","title":"","content":"### Cost breakdown for your team"},"7":{"type":"markdown","title":"","content":"---"},"8":{"type":"data","title":"Team cost per hour","query":"fetch bizevents\n| filter event.type == \"instance.spend\"\n\n| lookup \n [fetch dt.entity.host\n | fieldsAdd tagged = contains(toString(tags), concat(\"dt.owner:\",$Owner))],\nlookupField:id, sourceField:dt.entity.host\n\n| filter lookup.tagged == true\n\n| summarize `Hour` = sum(total_hourly_cost), by:{bin(timestamp, 1h)}\n| limit 20000\n","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{},"fieldMapping":{"timestamp":"bin(timestamp, 1h)","leftAxisValues":["Hour"],"leftAxisDimensions":[],"fields":[],"values":[]}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"Hour","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Hour","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":1,"suffix":"USD/hour","delimiter":false,"added":1705942715083}]}},"9":{"type":"data","title":"Team cost per day","query":"fetch bizevents\n| filter event.type == \"instance.spend\"\n\n| lookup \n [fetch dt.entity.host\n | fieldsAdd tagged = contains(toString(tags), concat(\"dt.owner:\",$Owner))\n],\nlookupField:id, sourceField:dt.entity.host\n\n| filter lookup.tagged == true\n| summarize `Day` = sum(total_hourly_cost)*24, by:{bin(timestamp, 1h)}\n| limit 20000\n","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{},"fieldMapping":{"timestamp":"bin(timestamp, 1h)","leftAxisValues":["Day"],"leftAxisDimensions":[],"fields":[],"values":[]}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"Day","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Day","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":1,"suffix":"USD/day","delimiter":false,"added":1705942729986}]}},"10":{"type":"data","title":"Team cost per month","query":"fetch bizevents\n| filter event.type == \"instance.spend\"\n\n| lookup \n [fetch dt.entity.host\n | fieldsAdd tagged = contains(toString(tags), concat(\"dt.owner:\",$Owner))\n],\nlookupField:id, sourceField:dt.entity.host\n\n| filter lookup.tagged == true\n| summarize `Week` = sum(total_hourly_cost)*24*7*4, by:{bin(timestamp, 1h)}\n| limit 20000\n","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{},"fieldMapping":{"timestamp":"bin(timestamp, 1h)","leftAxisValues":["Week"],"leftAxisDimensions":[],"fields":[],"values":[]}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"Week","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Week","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":1,"suffix":"USD/month","delimiter":false,"added":1705942746437}]}},"11":{"type":"data","title":"Team cost per year","query":"fetch bizevents\n| filter event.type == \"instance.spend\"\n\n| lookup \n [fetch dt.entity.host\n | fieldsAdd tagged = contains(toString(tags), concat(\"dt.owner:\",$Owner))\n],\nlookupField:id, sourceField:dt.entity.host\n\n| filter lookup.tagged == true\n| summarize `Year` = sum(total_hourly_cost)*24*7*52, by:{bin(timestamp, 1h)}\n| limit 20000\n","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{},"fieldMapping":{"timestamp":"bin(timestamp, 1h)","leftAxisValues":["Year"],"leftAxisDimensions":[],"fields":[],"values":[]}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"Year","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Year","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":1,"suffix":"USD/year","delimiter":false,"added":1705942774020}]}},"13":{"type":"data","title":"","query":"fetch bizevents, from:-24h\n// every hour Carbon app generates a instance.spend with\n// each dynatrace instance cost per hour\n| filter event.type == \"instance.spend\" and total_hourly_cost != 0\n\n| lookup [\nfetch dt.entity.host\n| fieldsAdd osVersion\n| fieldsAdd lifetime, totalLife = now() - lifetime[start]\n| fieldsAdd totalUptimeHours = toDouble(totalLife) / (60 * 60 * 1000 * 1000 * 1000) // hours = minutes * seconds * milli * micro\n| fieldsAdd tagged = contains(toString(tags), concat(\"dt.owner:\",$Owner))]\n, lookupField:id, sourceField:dt.entity.host\n\n\n| filter lookup.tagged == true \n| fields `Host name` = lookup.entity.name, id = dt.entity.host ,`Lifetime` = lookup.totalLife,`Lifetime spend` = toDouble(total_hourly_cost * lookup.totalUptimeHours), Hourly = total_hourly_cost\n| dedup id\n| limit 20000\n\n","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Host name","valueAxis":"Lifetime","categoryAxisLabel":"Host name","valueAxisLabel":"Lifetime"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"Host name"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Lifetime spend","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":1,"suffix":"","delimiter":false,"added":1705942668977},{"identifier":"Hourly","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":3,"suffix":"","delimiter":false,"added":1705942677788}]}}},"layouts":{"5":{"x":0,"y":5,"w":24,"h":6},"6":{"x":0,"y":0,"w":24,"h":1},"7":{"x":0,"y":4,"w":24,"h":1},"8":{"x":0,"y":1,"w":6,"h":3},"9":{"x":6,"y":1,"w":6,"h":3},"10":{"x":12,"y":1,"w":6,"h":3},"11":{"x":18,"y":1,"w":6,"h":3},"13":{"x":0,"y":11,"w":24,"h":5}}}